# ObjWatch Visualizer 调试指南

## 概述

ObjWatch Visualizer 扩展提供了完整的调试工具集，帮助开发者监控扩展性能、诊断问题和优化用户体验。

## 调试面板使用

### 打开调试面板

有三种方式打开调试面板：

1. **命令面板**：按 `Ctrl+Shift+P`，输入 "ObjWatch: Show Debug Panel"
2. **快捷键**：使用默认快捷键 `Ctrl+Shift+D`
3. **状态栏**：点击状态栏中的调试图标（如果已配置）

### 面板功能详解

#### 1. 性能统计
- **渲染时间**：显示最近20次渲染的平均、最大、最小耗时
- **事件处理**：事件解析和处理的性能指标
- **内存使用**：当前内存占用和峰值内存

#### 2. 内存监控
- **当前内存**：扩展当前使用的内存大小
- **内存趋势**：内存使用变化趋势图
- **优化建议**：基于内存使用情况的优化建议

#### 3. 错误信息
- **错误历史**：最近发生的错误列表
- **错误类型**：错误分类和统计
- **恢复状态**：错误自动恢复的成功率

#### 4. 事件统计
- **事件总数**：已处理的事件数量
- **事件类型分布**：RUN、END、UPD、APD、POP事件的比例
- **事件频率**：事件产生的速率统计

## 性能优化技巧

### 1. 大文件处理
当处理大型 `objwatch.json` 文件时：

```javascript
// 在VSCode设置中调整
{
    "objwatchVisualizer.maxEvents": 500,  // 减少显示事件数量
    "objwatchVisualizer.refreshInterval": 2000,  // 增加刷新间隔
    "objwatchVisualizer.memoryOptimization": true
}
```

### 2. 内存优化
扩展自动执行以下内存优化：
- **事件限制**：只保留最近的事件数据
- **定期清理**：每30秒自动清理过期数据
- **内存阈值**：当内存超过500MB时触发强制清理

### 3. 渲染优化
- **防抖机制**：文件变化时延迟100ms再更新界面
- **增量更新**：只更新变化的部分，而非整个界面
- **虚拟滚动**：只渲染可见区域的事件

## 错误诊断

### 常见错误类型

#### 1. 文件访问错误
- **症状**：无法读取 `objwatch.json` 文件
- **原因**：文件不存在、权限不足或文件被锁定
- **解决方案**：检查文件路径和权限设置

#### 2. JSON解析错误
- **症状**：JSON格式不正确
- **原因**：文件损坏或格式错误
- **解决方案**：验证JSON格式，使用JSON验证工具

#### 3. 内存不足错误
- **症状**：扩展变慢或崩溃
- **原因**：处理过大文件或内存泄漏
- **解决方案**：启用内存优化，减少显示事件数量

### 错误恢复机制

扩展内置了智能错误恢复系统：

1. **可恢复错误**：自动重试操作（如文件读取）
2. **部分恢复**：跳过损坏的数据，继续处理有效部分
3. **用户提示**：提供清晰的错误信息和恢复建议

## 调试模式

### 启用详细日志

在VSCode设置中启用调试模式：

```json
{
    "objwatchVisualizer.debug": true,
    "objwatchVisualizer.logLevel": "verbose"
}
```

### 查看调试日志

1. 打开VSCode的输出面板 (`Ctrl+Shift+U`)
2. 选择 "ObjWatch Visualizer" 输出通道
3. 查看详细的调试信息

### 日志级别

- **error**：只显示错误信息
- **warn**：显示警告和错误
- **info**：显示基本信息（默认）
- **verbose**：显示所有调试信息

## 性能测试

### 基准测试

扩展包含内置的性能基准测试：

```javascript
// 在调试面板中运行性能测试
// 测试项目：
// - 文件加载性能
// - 事件解析速度
// - 渲染性能
// - 内存使用效率
```

### 性能指标

- **文件加载时间**：< 100ms（小文件）
- **事件解析速度**：> 1000 events/sec
- **渲染帧率**：> 30fps
- **内存占用**：< 100MB（正常使用）

## 故障排除流程

### 步骤1：基础检查
1. 确认 `objwatch.json` 文件存在且可读
2. 验证JSON文件格式正确
3. 检查文件大小是否合理

### 步骤2：扩展状态检查
1. 打开调试面板查看错误信息
2. 检查内存使用情况
3. 查看性能统计数据

### 步骤3：高级诊断
1. 启用详细日志模式
2. 重现问题并记录日志
3. 分析日志中的错误信息

### 步骤4：解决方案
1. 根据错误类型采取相应措施
2. 调整扩展设置优化性能
3. 如问题持续，联系技术支持

## 技术支持

如果遇到无法解决的问题：

1. **收集信息**：
   - 错误日志截图
   - 调试面板数据
   - 系统环境信息

2. **提交问题**：
   - 在GitHub仓库创建issue
   - 提供详细的复现步骤
   - 附上相关日志文件

3. **获取帮助**：
   - 查看在线文档
   - 参与社区讨论
   - 联系开发团队

## 更新和维护

扩展会定期更新以改进性能和修复问题：

- **自动更新**：VSCode自动下载更新
- **手动检查**：在扩展面板检查更新
- **版本历史**：查看更新日志了解改进内容

---

*本指南最后更新：2025年*